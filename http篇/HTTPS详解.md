### 常用的几种加密方式

#### 共享密钥加密

加密和解密使用同一个密钥的方式称为共享密钥加密，也被叫做对称密钥加密。如果客户端和服务端使用同一把密钥，那么密钥就必须发送给对方，如果在互联网上转发密钥，那么就有可能被监听，密钥就有可能落入攻击者之手，那这样的加密方式肯定就不安全。

#### 公开密钥加密

公开密钥加密的出现就很好的解决了共享密钥加密的困难。公开密钥加密使用一对非对称的密钥。一把叫做私有密钥，另一把叫公开密钥。顾名思义，私有密钥不能让其他任何人知道，而公开密钥则可以随意发布，任何人都可以获得。

使用公开密钥加密方式，发送密钥的一方使用对方的公开密钥进行加密处理后，把用公开密钥加密的信息发送给对方，而对方再使用自己的私有密钥进行解密。利用这种方式，不需要发送解密的私有密钥，也就不必担心密钥被攻击者窃听了。就目前的技术来看，单单对一个使用公开密钥加密后的信息来解密是不太可能实现的！

#### HTTPS采用的混合加密机制

HTTPS采用共享密钥加密和公开密钥加密两者混合加密机制。仅仅在传输共享密钥时使用公开密钥加密，在一般的传输报文时使用共享密钥加密方式。这样就充分利用了两者各自的优势(共享加解密处理速度比公开密钥加解密快)，将多种方法组合起来用于通信。

### 证书

其实，在公开密钥加密方式还是存在一些问题。那就是无法证明公开密钥本身就是货真价实的公开密钥。比如，如何证明收到的公开密钥就是原本你想请求那台服务器的公开密钥，或许在公开密钥传输途中，真正的公开密钥已经被攻击者替换掉了呢。

为了解决上述问题，可以使用由数字证书认证机构（CA)和其他相关机关颁发的公开密钥证书。

### HTTPS的安全通信机制

HTTPS的通信步骤:

1. 客户端发送Client Hello 报文开始SSL通信。报文中包含客户端支持的SSL的指定版本、加密组件列表(所使用的加密算法及密钥长度等)。
2. 服务器进行SSL通信，会以Server Hello 报文作为应答。和客户端一样，在报文中包含SSL版本以及加密组件。
3. 之后服务器发送Certificate报文。报文中包含公开密钥证书。
4. 最后服务器发送Server Hello Done 报文通知客户端，最初阶段的SSL 握手协商部分结束。
5. SSL第一次握手后，客户端以Client Key Exchange报文作为回应，报文中包含通信加密中使用的一种被称为Pre-master secret  的随机密码串。该报文已使用步骤3中的公开密钥进行加密。
6. 接着客户端继续发送Change Cipher Spec 报文。该报文会提示服务器，在此报文之后的通信会采用Pre-master secret 密钥加密。
7. 客户端发送Finished 报文。该报文包含连接至今全部报文的整体校验值。这次握手协商是否能够成功，要以服务器是否能够正确解密该报文作为判定标准。
8. 服务器同样发送Change Cipher Spec 报文。
9. 服务器同样发送Finished 报文
10. 服务器和客户端的Finished 报文交换完毕之后，SSL连接就算建立完成。当然，通信会受到SSL保护。从此处开始进行应用层协议的通信，即发送HTTP请求。
11. 应用层协议通信，即发送HTTP响应
12. 最后由客户端端口连接。断开时发送close_notify报文。

在以上的流程中，应用层发送数据时会附加一种叫做MAC的报文摘要。MAC能够查知报文是否遭到篡改，从而保护报文的完整性。

- SSL和TLS

  HTTPS使用SSL和TLS这两个协议。SSL技术最初是由网景公司率先倡导的，开发过SSL3.0之前的版本。之后，TLS以SSL为原型开发协议，指定出了TLS1.0/1.1/1.2。当前的主流版本是SSL3.0 和 TLS 1.0

- SSL处理的速度会变慢，HTTPS比 HTTP 要慢 2到100倍。

- 为什么不一直使用HTTPS？

  其中一个原因是，因为与纯文本通信相比，加密通信会消耗更多的CPU以及内存资源。其二是要进行HTTPS通信，证书不可少。而使用的证书必须向CA购买。





参考：阮老师的[SSL/TLS协议运行机制的概述](https://www.ruanyifeng.com/blog/2014/02/ssl_tls.html) 和 [图解SSL/TLS协议](https://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html)